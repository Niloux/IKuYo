# `frontend/src/components/TaskTable.vue` 代码审查

## 分析

`TaskTable.vue` 组件用于以卡片网格的形式展示即时爬虫任务。它负责显示任务的状态、基本信息、进度（对于运行中的任务），并提供取消任务的操作。

1.  **Props 定义**: 接收 `tasks`（任务列表）、`isLoading`（加载状态）、`error`（错误信息）、`onCancel`（取消任务回调）、`currentPage` 和 `pageSize`（分页信息）。
2.  **事件触发**: 触发 `retry`（重试加载）和 `page-change`（分页切换）事件。
3.  **条件渲染**: 根据 `isLoading`、`error` 和 `tasks` 列表的长度显示加载中、错误信息或无数据提示。
4.  **任务卡片**: 每个任务以一个卡片的形式展示，包含任务 ID、状态、标题、类型、模式、创建时间。
5.  **进度显示**: 对于运行中的任务，显示进度百分比、剩余时间估算和进度条。
6.  **取消操作**: 提供取消按钮，并根据任务状态判断是否可取消。
7.  **分页控制**: 提供了简单的“上一页/下一页”分页按钮。
8.  **辅助函数**: 导入并使用了 `getParameter`、`formatDateTime` 和 `formatTime`。内部定义了 `getStatusText`、`getTaskTitle`、`canCancel` 和 `getCancelButtonText`。
9.  **样式**: 样式使用 `scoped`，包含了任务网格、卡片、状态徽章、进度条和分页控制的样式，并有响应式媒体查询。

## 建议和理由

### 1. `getTaskTitle` 函数的冗余与类型安全

*   **建议**: `getTaskTitle` 函数内部再次对 `task.parameters` 进行 `JSON.parse`，并根据 `mode` 字段构建标题。这与 `utils/taskUtils.ts` 中的 `getParameter` 函数有功能上的重叠，并且在 `TaskManagementView.vue` 中也存在类似的逻辑。
*   **理由**: 建议将 `task.parameters` 的解析和模式相关的标题生成逻辑封装到 `taskUtils.ts` 中，或者在 `taskStore` 中对 `TaskResponse` 进行预处理，使其包含一个已解析的 `parameters` 对象。这样可以避免重复解析 JSON 字符串，提高类型安全性，并集中管理任务标题的生成逻辑。

### 2. 分页逻辑的通用性

*   **建议**: 当前的分页逻辑（“上一页/下一页”按钮）是手动实现的。如果未来需要更复杂的分页 UI（例如，页码列表、快速跳转），则需要在此组件中添加更多逻辑。
*   **理由**: 考虑将分页组件封装成一个独立的、可复用的 Vue 组件。这个组件可以接收 `currentPage`、`pageSize`、`totalItems` 等 props，并发出页码改变事件。这样可以提高代码的复用性，并使 `TaskTable` 的模板更简洁。

### 3. 进度条的剩余时间显示

*   **建议**: `formatTime(task.estimated_remaining || 0)` 用于显示剩余时间。这依赖于后端提供的 `estimated_remaining` 字段。
*   **理由**: 确保 `estimated_remaining` 字段的准确性。如果后端不提供或提供不准确，前端可以考虑根据 `processed_items` 和 `total_items` 以及处理速度进行估算，或者在没有数据时显示“计算中...”或“未知”。

### 4. `getCancelButtonText` 的逻辑

*   **建议**: `getCancelButtonText` 函数在 `canCancel(status)` 为 `false` 时返回“已完成”。这可能导致按钮文本与实际任务状态不完全匹配（例如，任务可能失败或已取消，但按钮显示“已完成”）。
*   **理由**: 建议根据任务的实际 `status` 返回更精确的按钮文本，例如“已完成”、“已失败”、“已取消”，或者在不可取消时完全禁用按钮并移除文本。

### 5. 样式中的硬编码颜色和值

*   **建议**: 样式中使用了许多硬编码的颜色值（如 `#fef3c7`、`#dbeafe`）和间距值。虽然部分使用了 CSS 变量，但可以更广泛地使用。
*   **理由**: 建议将这些常用的颜色、字体大小、间距、阴影等定义为 CSS 变量，并在整个应用中复用。这有助于实现主题化，提高样式的一致性和可维护性。

### 6. 可访问性 (Accessibility)

*   **建议**: 对于取消按钮，可以考虑添加 `aria-label` 属性来描述按钮的功能（如“取消任务”），以提高可访问性。
*   **理由**: 帮助使用屏幕阅读器的用户更好地理解和操作按钮。

### 7. 动画效果

*   **建议**: 组件根元素使用了 `fade-in` 类，但没有看到对应的 CSS 动画定义。如果目的是实现淡入效果，需要确保 CSS 中有相应的 `@keyframes` 规则。
*   **理由**: 确保所有引用的 CSS 类都有对应的样式定义，以避免不必要的类名或未实现的动画。

### 总结

`TaskTable.vue` 组件在展示即时任务和提供取消操作方面做得很好。主要的改进点在于优化 `getTaskTitle` 的逻辑以避免重复解析，将分页功能抽象为可复用组件，以及细化取消按钮的文本显示，以提高代码的可维护性、用户体验和性能。
