# `frontend/src/utils/taskUtils.ts` 代码审查

## 分析

`taskUtils.ts` 文件包含了一组与任务相关的工具函数，主要用于格式化和解析任务数据，以便在前端界面中更好地展示。

1.  **`getParameter`**: 用于从任务的 `parameters` 字符串（假定为 JSON 格式）中提取特定键的值。它还对 `mode` 字段进行了特殊处理，以显示更友好的中文描述。
2.  **`formatDateTime`**: 用于将日期时间字符串格式化为本地化的日期时间字符串。
3.  **`formatTime`**: 用于将秒数格式化为“分钟 m 秒 s”的字符串格式。

## 建议和理由

### 1. `getParameter` 函数的健壮性与类型安全

*   **建议**: `getParameter` 函数假定 `parameters` 是一个 JSON 字符串。如果 `parameters` 不是有效的 JSON 字符串，`JSON.parse` 会抛出错误，虽然有 `try-catch` 捕获，但返回的 `'-'` 可能无法提供足够的信息。此外，`params[key]` 的访问没有类型检查。
*   **理由**:
    *   **类型安全**: 考虑使用 TypeScript 的类型守卫或更严格的类型定义来确保 `params` 对象的结构。如果 `parameters` 字段在 `TaskResponse` 中已经被定义为对象类型（如 `Record<string, any>`），那么就不需要 `JSON.parse`，可以直接访问属性，从而提高类型安全性。
    *   **错误信息**: 当 `JSON.parse` 失败时，仅仅返回 `'-'` 可能不足以帮助调试。可以考虑在开发模式下抛出更详细的错误，或者返回一个表示解析失败的特殊值。
    *   **默认值**: 对于 `params.mode`、`params.year`、`params.season`，如果它们不存在，会返回空字符串或 `'-'`。这可能导致像 `季度 (年)` 这样的显示。可以考虑在 `switch` 语句中对 `params.year` 和 `params.season` 进行更严格的检查，确保它们存在时才拼接。

### 2. `formatDateTime` 的国际化和格式化选项

*   **建议**: `date.toLocaleString()` 会根据用户的浏览器设置进行格式化。这在大多数情况下是可接受的，但如果需要更精细的控制日期时间格式（例如，统一显示为 `YYYY-MM-DD HH:mm:ss`），则需要使用 `Intl.DateTimeFormat` 或第三方库（如 `dayjs` 或 `date-fns`）。
*   **理由**:
    *   **一致性**: 统一的日期时间格式可以提高用户界面的视觉一致性。
    *   **灵活性**: `Intl.DateTimeFormat` 提供了丰富的选项来定制日期时间的显示，例如时区、日期/时间组件的显示方式等。

### 3. `formatTime` 的单位和可读性

*   **建议**: `formatTime` 将秒数格式化为 `分钟 m 秒 s`。对于较长的持续时间，可能需要显示小时甚至天。此外，如果秒数小于 1 分钟，显示 `0m Xs` 可能不够简洁。
*   **理由**:
    *   **完整性**: 考虑处理小时和天，以适应更长的任务持续时间。
    *   **简洁性**: 对于小于 60 秒的时间，可以直接显示为 `Xs`，或者根据需求决定是否显示 `0m`。
    *   **单位**: `m` 和 `s` 是常见的缩写，但如果需要更正式或更清晰的显示，可以使用 `分钟` 和 `秒`。

### 4. 统一的空值/默认值处理

*   **建议**: 多个函数在输入为 `undefined` 或空时返回 `'-'`。这是一种常见的做法，但请确保在所有需要显示默认值的地方都保持一致。
*   **理由**: 统一的默认值处理可以提高用户界面的可预测性。

### 总结

`taskUtils.ts` 提供了一些实用的工具函数来处理任务相关的数据展示。主要的改进点在于增强 `getParameter` 的健壮性和类型安全性，考虑 `formatDateTime` 的国际化和格式化选项，以及扩展 `formatTime` 以处理更长的持续时间，从而提高代码的可靠性和用户体验。
